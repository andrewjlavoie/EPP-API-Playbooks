---
- name: Get JWT
  tasks:
  - name: Check status 200
    uri:
      url: https://{{ rest_server }}/api/login
      method: POST
      headers:
        Content-Type: "application/json"
      body: '{"username": {{ username }}, "password": {{ password }} }'
      return_content: yes

    register: token

    - name: Show authentication token
        debug: 
        msg: "{{ token.content }}"

    - name: Check that LOGIN returns a status 200
    uri:
        url: https://{{ rest_server }}/api/login/
        method: POST
        headers:
        Content-Type: "application/json"
        Authorization: {{ (token.content | from_json).token }}"
        body: '{"username": "user", "password": "pass"}'
        return_content: yes

    register: webpage